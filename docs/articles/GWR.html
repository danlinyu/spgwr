<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geographically Weighted Regression • spgwr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Geographically Weighted Regression">
<meta property="og:description" content="spgwr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spgwr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6-36</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GWR.html">Geographically Weighted Regression</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rsbivand/spgwr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Geographically Weighted Regression</h1>
                        <h4 data-toc-skip class="author">Roger
Bivand</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rsbivand/spgwr/blob/HEAD/vignettes/GWR.Rmd" class="external-link"><code>vignettes/GWR.Rmd</code></a></small>
      <div class="hidden name"><code>GWR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="geographically-weighted-regression-1">Geographically Weighted Regression <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a><a class="anchor" aria-label="anchor" href="#geographically-weighted-regression-1"></a>
</h2>
<p>Geographically weighted regression (GWR) is an exploratory technique
mainly intended to indicate where non-stationarity is taking place on
the map, that is where locally weighted regression coefficients move
away from their global values. Its basis is the concern that the fitted
coefficient values of a global model, fitted to all the data, may not
represent detailed local variations in the data adequately - in this it
follows other local regression implementations. It differs, however, in
not looking for local variation in <em>data</em> space, but by moving a
weighted window over the data, estimating one set of coefficient values
at every chosen <em>fit</em> point. The fit points are very often the
points at which observations were made, but do not have to be. If the
local coefficients vary in space, it can be taken as an indication of
non-stationarity.</p>
<p>The technique is fully described by <span class="citation">Fotheringham, Brunsdon, and Charlton (<a href="#ref-fotheringhametal:02" role="doc-biblioref">2002</a>)</span>
and involves first selecting a bandwidth for an isotropic spatial
weights kernel, typically a Gaussian kernel with a fixed bandwidth
chosen by leave-one-out cross-validation. Choice of the bandwidth can be
very demanding, as <span class="math inline">\(n\)</span> regressions
must be fitted at each step. Alternative techniques are available, for
example for adaptive bandwidths, but they may often be even more
compute-intensive. GWR is discussed by <span class="citation">Schabenberger and Gotway (<a href="#ref-schabenberger+gotway:2005" role="doc-biblioref">2005</a>)</span> and <span class="citation">Waller
and Gotway (<a href="#ref-WallerGotway:2004" role="doc-biblioref">2004</a>)</span>, and presented with examples by
<span class="citation">Lloyd (<a href="#ref-lloyd:07" role="doc-biblioref">2007</a>)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rsbivand/spgwr/" class="external-link">spgwr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<pre><code><span><span class="co">## The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">## which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">## Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">## https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">## It may be desirable to make the sf package available;</span></span>
<span><span class="co">## package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">## The sp package is now running under evolution status 2</span></span>
<span><span class="co">##      (status 2 uses the sf package in place of rgdal)</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: spData</span></span></code></pre>
<pre><code><span><span class="co">## NOTE: This package does not constitute approval of GWR</span></span>
<span><span class="co">## as a method of spatial analysis; see example(gwr)</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NY8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/NY8_utm18.shp"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bwG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">Z</span><span class="op">~</span><span class="va">PEXPOSURE</span><span class="op">+</span><span class="va">PCTAGE65P</span><span class="op">+</span><span class="va">PCTOWNHOME</span>, data<span class="op">=</span><span class="va">NY8</span>, gweight<span class="op">=</span><span class="va">gwr.Gauss</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">gwrG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gwr.html">gwr</a></span><span class="op">(</span><span class="va">Z</span><span class="op">~</span><span class="va">PEXPOSURE</span><span class="op">+</span><span class="va">PCTAGE65P</span><span class="op">+</span><span class="va">PCTOWNHOME</span>, data<span class="op">=</span><span class="va">NY8</span>, bandwidth<span class="op">=</span><span class="va">bwG</span>, gweight<span class="op">=</span><span class="va">gwr.Gauss</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gwrG</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## gwr(formula = Z ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME, data = NY8, </span></span>
<span><span class="co">##     bandwidth = bwG, gweight = gwr.Gauss, hatmatrix = TRUE)</span></span>
<span><span class="co">## Kernel function: gwr.Gauss </span></span>
<span><span class="co">## Fixed bandwidth: 179942.6 </span></span>
<span><span class="co">## Summary of GWR coefficient estimates at data points:</span></span>
<span><span class="co">##                   Min.   1st Qu.    Median   3rd Qu.      Max.  Global</span></span>
<span><span class="co">## X.Intercept. -0.522172 -0.520740 -0.520154 -0.514439 -0.511092 -0.5173</span></span>
<span><span class="co">## PEXPOSURE     0.047176  0.048032  0.049527  0.049722  0.050477  0.0488</span></span>
<span><span class="co">## PCTAGE65P     3.911526  3.933832  3.959192  3.962334  3.979552  3.9509</span></span>
<span><span class="co">## PCTOWNHOME   -0.559358 -0.557968 -0.557682 -0.555498 -0.554563 -0.5600</span></span>
<span><span class="co">## Number of data points: 281 </span></span>
<span><span class="co">## Effective number of parameters (residual: 2traceS - traceS'S): 4.39979 </span></span>
<span><span class="co">## Effective degrees of freedom (residual: 2traceS - traceS'S): 276.6002 </span></span>
<span><span class="co">## Sigma (residual: 2traceS - traceS'S): 0.6575073 </span></span>
<span><span class="co">## Effective number of parameters (model: traceS): 4.206294 </span></span>
<span><span class="co">## Effective degrees of freedom (model: traceS): 276.7937 </span></span>
<span><span class="co">## Sigma (model: traceS): 0.6572774 </span></span>
<span><span class="co">## Sigma (ML): 0.6523395 </span></span>
<span><span class="co">## AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 568.0103 </span></span>
<span><span class="co">## AIC (GWR p. 96, eq. 4.22): 561.5689 </span></span>
<span><span class="co">## Residual sum of squares: 119.5786 </span></span>
<span><span class="co">## Quasi-global R2: 0.1934333</span></span></code></pre>
<p>Once the bandwidth has been found, or chosen by hand, the
<code>gwr</code> function may be used to fit the model with the chosen
local kernel and bandwidth. If the <code>data</code> argument is passed
a <code>SpatialPolygonsDataFrame</code> or a
<code>SpatialPointsDataFrame</code> object, the output object will
contain a component, which is an object of the same geometry populated
with the local coefficient estimates. If the input objects have polygon
support, the centroids of the spatial entities are taken as the basis
for analysis. The function also takes a <code>fit.points</code>
argument, which permits local coefficients to be created by
geographically weighted regression for other support than the data
points.</p>
<p>The basic GWR results are uninteresting for this data set, with very
little local variation in coefficient values; the bandwidth is almost
180 km. Neither <code>gwr</code> nor <code>gwr.sel</code> yet take a
<code>weights</code> argument, as it is unclear how non-spatial and
geographical weights should be combined. A further issue that has arisen
is that it seems that local collinearity can be induced, or at least
observed, in GWR applications. A discussion of the issues raised is
given by <span class="citation">Wheeler and Tiefelsdorf (<a href="#ref-wheeler+tiefelsdorf:05" role="doc-biblioref">2005</a>)</span>.</p>
<p>As <span class="citation">Fotheringham, Brunsdon, and Charlton (<a href="#ref-fotheringhametal:02" role="doc-biblioref">2002</a>)</span>
describe, GWR can also be applied in a GLM framework, and a provisional
implementation permitting this has been added to the <code>spgwr</code>
package providing both cross-validation bandwidth selection and
geographically weighted fitting of GLM models.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbwG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggwr.sel.html">ggwr.sel</a></span><span class="op">(</span><span class="va">Cases</span><span class="op">~</span><span class="va">PEXPOSURE</span><span class="op">+</span><span class="va">PCTAGE65P</span><span class="op">+</span><span class="va">PCTOWNHOME</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">POP8</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">NY8</span>, family<span class="op">=</span><span class="st">"poisson"</span>, gweight<span class="op">=</span><span class="va">gwr.Gauss</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ggwrG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggwr.html">ggwr</a></span><span class="op">(</span><span class="va">Cases</span><span class="op">~</span><span class="va">PEXPOSURE</span><span class="op">+</span><span class="va">PCTAGE65P</span><span class="op">+</span><span class="va">PCTOWNHOME</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">POP8</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">NY8</span>, family<span class="op">=</span><span class="st">"poisson"</span>, bandwidth<span class="op">=</span><span class="va">gbwG</span>, gweight<span class="op">=</span><span class="va">gwr.Gauss</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ggwrG</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## ggwr(formula = Cases ~ PEXPOSURE + PCTAGE65P + PCTOWNHOME + offset(log(POP8)), </span></span>
<span><span class="co">##     data = NY8, bandwidth = gbwG, gweight = gwr.Gauss, family = "poisson")</span></span>
<span><span class="co">## Kernel function: gwr.Gauss </span></span>
<span><span class="co">## Fixed bandwidth: 179942.6 </span></span>
<span><span class="co">## Summary of GWR coefficient estimates at data points:</span></span>
<span><span class="co">##                  Min.  1st Qu.   Median  3rd Qu.     Max.  Global</span></span>
<span><span class="co">## X.Intercept. -8.13847 -8.13586 -8.13529 -8.13467 -8.13164 -8.1344</span></span>
<span><span class="co">## PEXPOSURE     0.14702  0.14776  0.14913  0.14931  0.15000  0.1489</span></span>
<span><span class="co">## PCTAGE65P     3.97506  3.98180  3.98418  4.00586  4.01816  3.9982</span></span>
<span><span class="co">## PCTOWNHOME   -0.35726 -0.35523 -0.35453 -0.34895 -0.34601 -0.3571</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">ggwrG</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"PEXPOSURE"</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">0.95</span>, <span class="fl">0.55</span>, <span class="fl">2.2</span><span class="op">)</span>, cuts<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><img src="GWR_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>The local coefficient variation seen in this fit is not large either,
although from the figure above, it appears that slightly larger local
coefficients for the closeness to TCE site covariate are found farther
away from TCE sites than close to them.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">ggwrG</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="GWR_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>If, on the other hand, we consider this indication in the light of
the figure above, it is clear that the forcing artefacts found by <span class="citation">Wheeler and Tiefelsdorf (<a href="#ref-wheeler+tiefelsdorf:05" role="doc-biblioref">2005</a>)</span>
in a different data set are replicated here.</p>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-fotheringhametal:02" class="csl-entry">
Fotheringham, A. S., C. Brunsdon, and M. E. Charlton. 2002.
<em>Geographically Weighted Regression: The Analysis of Spatially
Varying Relationships</em>. Chichester: Wiley.
</div>
<div id="ref-lloyd:07" class="csl-entry">
Lloyd, C. D. 2007. <em>Local Models for Spatial Analysis</em>. Boca
Raton: CRC.
</div>
<div id="ref-schabenberger+gotway:2005" class="csl-entry">
Schabenberger, O., and C. A. Gotway. 2005. <em>Statistical Methods for
Spatial Data Analysis</em>. London: Chapman &amp; Hall.
</div>
<div id="ref-WallerGotway:2004" class="csl-entry">
Waller, L. A., and C. A. Gotway. 2004. <em>Applied Spatial Statistics
for Public Health Data</em>. Hoboken, NJ: Wiley.
</div>
<div id="ref-wheeler+tiefelsdorf:05" class="csl-entry">
Wheeler, D., and M. Tiefelsdorf. 2005. <span>“Multicollinearity and
Correlation Among Local Regression Coefficients in Geographically
Weighted Regression.”</span> <em>Journal of Geographical Systems</em> 7:
161–87.
</div>
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>This vignette formed pp. 305-308 of the first edition of
Bivand, R. S., Pebesma, E. and Gómez-Rubio V. (2008) Applied Spatial
Data Analysis with R, Springer-Verlag, New York. It was retired from the
second edition (2013) to accommodate material on other topics, and is
made available in this form with the understanding of the publishers.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Roger Bivand, Danlin Yu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
