<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Geographically weighted regression — gwr • spgwr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Geographically weighted regression — gwr"><meta property="og:description" content="The function implements the basic geographically weighted regression approach
to exploring spatial non-stationarity for given global bandwidth and chosen
weighting scheme."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spgwr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6-36</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rsbivand/spgwr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Geographically weighted regression</h1>
    
    <div class="hidden name"><code>gwr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function implements the basic geographically weighted regression approach
to exploring spatial non-stationarity for given global bandwidth and chosen
weighting scheme.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gwr</span><span class="op">(</span><span class="va">formula</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">coords</span>, <span class="va">bandwidth</span>, gweight<span class="op">=</span><span class="va">gwr.Gauss</span>, </span>
<span>  adapt<span class="op">=</span><span class="cn">NULL</span>, hatmatrix <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">fit.points</span>, longlat<span class="op">=</span><span class="cn">NULL</span>, </span>
<span>  se.fit<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">weights</span>, cl<span class="op">=</span><span class="cn">NULL</span>, predictions <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>        fittedGWRobject <span class="op">=</span> <span class="cn">NULL</span>, se.fit.CCT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for gwr</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>regression model formula as in <code>lm</code></p></dd>

  <dt>data</dt>
<dd><p>model data frame, or SpatialPointsDataFrame or SpatialPolygonsDataFrame as defined in package <span class="pkg">sp</span></p></dd>

  <dt>coords</dt>
<dd><p>matrix of coordinates of points representing the spatial
  positions of the observations; may be omitted if the object passed through the data argument is from package <span class="pkg">sp</span></p></dd>

  <dt>bandwidth</dt>
<dd><p>bandwidth used in the weighting function, possibly
  calculated by <code>gwr.sel</code></p></dd>

  <dt>gweight</dt>
<dd><p>geographical weighting function, at present 
  <code><a href="gwr.gauss.html">gwr.Gauss()</a></code> default, or <code><a href="gwr.gauss.html">gwr.gauss()</a></code>, the previous default or <code><a href="gwr.bisquare.html">gwr.bisquare()</a></code></p></dd>

  <dt>adapt</dt>
<dd><p>either NULL (default) or a proportion between 0 and 1 of observations to include in weighting scheme (k-nearest neighbours)</p></dd>

  <dt>hatmatrix</dt>
<dd><p>if TRUE, return the hatmatrix as a component of the result, ignored if <code>fit.points</code> given</p></dd>

  <dt>fit.points</dt>
<dd><p>an object containing the coordinates of fit points; often an object from package <span class="pkg">sp</span>; if missing, the coordinates given through the data argument object, or the coords argument are used</p></dd>

  <dt>longlat</dt>
<dd><p>TRUE if point coordinates are longitude-latitude decimal degrees, in which case distances are measured in kilometers; if x is a SpatialPoints object, the value is taken from the object itself</p></dd>

  <dt>se.fit</dt>
<dd><p>if TRUE, return local coefficient standard errors - if <code>hatmatrix</code> is TRUE and no fit.points are given, two effective degrees of freedom sigmas will be used to generate alternative coefficient standard errors</p></dd>

  <dt>weights</dt>
<dd><p>case weights used as in weighted least squares, beware of scaling issues, probably unsafe</p></dd>

  <dt>cl</dt>
<dd><p>if NULL, ignored, otherwise <code>cl</code> must be an object describing a “cluster” created using <code>makeCluster</code> in the <span class="pkg">parallel</span> package. The cluster will then be used to hand off the calculation of local coefficients to cluster nodes, if fit points have been given as an argument, and <code>hatmatrix=FALSE</code></p></dd>

  <dt>predictions</dt>
<dd><p>default FALSE; if TRUE and no fit points given, return GW fitted values at data points, if fit points given and are a Spatial*DataFrame object containing the RHS variables in the formula, return GW predictions at the fit points</p></dd>

  <dt>fittedGWRobject</dt>
<dd><p>a fitted <code>gwr</code> object with a hatmatrix (optional), if given, and if fit.points are given and if <code>se.fit</code> is TRUE, two effective degrees of freedom sigmas will be used to generate alternative coefficient standard errors</p></dd>

  <dt>se.fit.CCT</dt>
<dd><p>default TRUE, compute local coefficient standard errors using formula (2.14), p. 55, in the GWR book</p></dd>

  <dt>x</dt>
<dd><p>an object of class "gwr" returned by the <code>gwr</code> function</p></dd>

  <dt>...</dt>
<dd><p>arguments to be passed to other functions</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function applies the weighting function in turn to each of the 
observations, or fit points if given, calculating a weighted regression 
for each point. The results may be explored to see if coefficient values vary over space. The local coefficient estimates may be made on a multi-node cluster using the <code>cl</code> argument to pass through a <span class="pkg">parallel</span> cluster. The function will then divide the fit points (which must be given separately) between the clusters for fitting. Note that each node will need to have the “spgwr” package present, so initiating by <code>clusterEvalQ(cl, library(spgwr))</code> may save a little time per node. The function clears the global environment on the node of objects sent. Using two nodes reduces timings to a little over half the time for a single node.</p>
<p>The section of the examples code now includes two simulation scenarios, showing how important it is to check that mapped pattern in local coefficients is actually there, rather than being an artefact.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of class “gwr”:</p>
<dl><dt>SDF</dt>
<dd><p>a SpatialPointsDataFrame (may be gridded) or SpatialPolygonsDataFrame object (see package "sp") with fit.points, weights, GWR coefficient estimates, R-squared, and coefficient standard errors in its "data" slot.</p></dd>

  <dt>lhat</dt>
<dd><p>Leung et al. L matrix</p></dd>

  <dt>lm</dt>
<dd><p>Ordinary least squares global regression on the same model formula, as returned by lm.wfit().</p></dd>

  <dt>bandwidth</dt>
<dd><p>the bandwidth used.</p></dd>

  <dt>this.call</dt>
<dd><p>the function call used.</p></dd>

</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Fotheringham, A.S., Brunsdon, C., and Charlton, M.E., 2002,
Geographically Weighted Regression, Chichester: Wiley; Paez A, Farber S, Wheeler D, 2011, "A simulation-based study of geographically weighted regression as a method for investigating spatially varying relationships", Environment and
Planning A 43(12) 2992-3010;
<a href="http://gwr.nuim.ie/" class="external-link">http://gwr.nuim.ie/</a></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Roger Bivand <a href="mailto:Roger.Bivand@nhh.no">Roger.Bivand@nhh.no</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="gwr.cv.html">gwr.sel</a></code>, <code><a href="gwr.gauss.html">gwr.gauss</a></code>,
<code><a href="gwr.bisquare.html">gwr.bisquare</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">columbus</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">col.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">col.lm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = CRIME ~ INC + HOVAL, data = columbus)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -34.418  -6.388  -1.580   9.052  28.649 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  68.6190     4.7355  14.490  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC          -1.5973     0.3341  -4.780 1.83e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL        -0.2739     0.1032  -2.654   0.0109 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 11.43 on 46 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.5524,	Adjusted R-squared:  0.5329 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 28.39 on 2 and 46 DF,  p-value: 9.341e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">col.bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span>  coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">$</span><span class="va">X</span>, <span class="va">columbus</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 12.65221 CV score: 7432.209 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 20.45127 CV score: 7462.704 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 7.83213 CV score: 7323.545 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 4.853154 CV score: 7307.57 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 5.125504 CV score: 7322.796 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 3.012046 CV score: 6461.764 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 1.874179 CV score: 6473.378 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.475485 CV score: 6109.995 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.447721 CV score: 6098.372 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.228647 CV score: 6064.1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.264538 CV score: 6060.774 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.280666 CV score: 6060.649 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.274969 CV score: 6060.601 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.2751 CV score: 6060.601 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.27506 CV score: 6060.601 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.275019 CV score: 6060.601 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 2.27506 CV score: 6060.601 </span>
<span class="r-in"><span><span class="va">col.gauss</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span>  coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">$</span><span class="va">X</span>, <span class="va">columbus</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, bandwidth<span class="op">=</span><span class="va">col.bw</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">col.gauss</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = CRIME ~ INC + HOVAL, data = columbus, coords = cbind(columbus$X, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     columbus$Y), bandwidth = col.bw, hatmatrix = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 2.27506 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Min.   1st Qu.    Median   3rd Qu.      Max.  Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept. 23.233234 54.124872 63.902588 68.756460 80.900619 68.6190</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC          -3.130714 -1.912908 -0.984380 -0.368564  1.291075 -1.5973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL        -1.052811 -0.376735 -0.097394  0.030049  0.794577 -0.2739</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 49 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 29.6163 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 19.3837 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 8.027502 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 23.92796 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 25.07204 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 7.058361 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 5.048946 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 403.6187 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): 321.6635 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 1249.101 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.9070486 </span>
<span class="r-in"><span><span class="va">col.d</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span>  coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">$</span><span class="va">X</span>, <span class="va">columbus</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, gweight<span class="op">=</span><span class="va">gwr.bisquare</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 12.65221 CV score: 8180.619 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 20.45127 CV score: 7552.85 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 25.27136 CV score: 7508.227 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 23.68132 CV score: 7519.864 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 28.25033 CV score: 7491.85 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 30.09144 CV score: 7486.673 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 31.69353 CV score: 7483.663 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 31.08159 CV score: 7484.706 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.21945 CV score: 7482.846 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.54449 CV score: 7482.371 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.74538 CV score: 7482.088 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.86953 CV score: 7481.916 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.94626 CV score: 7481.812 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 32.99368 CV score: 7481.748 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.02299 CV score: 7481.708 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.04111 CV score: 7481.684 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.0523 CV score: 7481.669 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.05922 CV score: 7481.659 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.0635 CV score: 7481.654 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.06614 CV score: 7481.65 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.06777 CV score: 7481.648 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.06878 CV score: 7481.647 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.06941 CV score: 7481.646 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.06979 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07003 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07018 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07027 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07032 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07037 CV score: 7481.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bandwidth: 33.07037 CV score: 7481.645 </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bandwidth converged to upper bound:33.0704149683672</span>
<span class="r-in"><span><span class="va">col.bisq</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span>  coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">$</span><span class="va">X</span>, <span class="va">columbus</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, bandwidth<span class="op">=</span><span class="va">col.d</span>, </span></span>
<span class="r-in"><span>  gweight<span class="op">=</span><span class="va">gwr.bisquare</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">col.bisq</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = CRIME ~ INC + HOVAL, data = columbus, coords = cbind(columbus$X, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     columbus$Y), bandwidth = col.d, gweight = gwr.bisquare, hatmatrix = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.bisquare </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 33.07037 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Min.  1st Qu.   Median  3rd Qu.     Max.  Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept. 68.30731 68.96074 69.26155 69.57103 71.64487 68.6190</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC          -1.72665 -1.64754 -1.61378 -1.56908 -1.46759 -1.5973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL        -0.33314 -0.30522 -0.28063 -0.25355 -0.18834 -0.2739</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 49 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 4.604881 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 44.39512 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 11.3765 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 3.917653 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 45.08235 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 11.28946 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 10.82875 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 383.6983 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): 376.4297 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 5745.83 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.5724262 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">g.adapt.gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span> </span></span>
<span class="r-in"><span> <span class="va">PctPov</span> <span class="op">+</span> <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, adapt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.381966 CV score: 2048.743 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.618034 CV score: 2028.561 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.763932 CV score: 2041.554 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.593544 CV score: 2027.538 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5306416 CV score: 2026.568 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.536485 CV score: 2026.541 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5402641 CV score: 2026.493 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5606152 CV score: 2026.641 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5480375 CV score: 2026.425 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5568526 CV score: 2026.552 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5514046 CV score: 2026.493 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5458334 CV score: 2026.425 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5468793 CV score: 2026.417 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5469222 CV score: 2026.417 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5473482 CV score: 2026.417 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.547116 CV score: 2026.416 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5471567 CV score: 2026.415 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5472298 CV score: 2026.416 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive q: 0.5471567 CV score: 2026.415 </span>
<span class="r-in"><span><span class="va">res.adpt</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span> <span class="va">PctPov</span> <span class="op">+</span> </span></span>
<span class="r-in"><span> <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, adapt<span class="op">=</span><span class="va">g.adapt.gauss</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res.adpt</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = PctBach ~ TotPop90 + PctRural + PctEld + PctFB + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     PctPov + PctBlack, data = gSRDF, adapt = g.adapt.gauss)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adaptive quantile: 0.5471567 (about 86 of 159 data points)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Min.     1st Qu.      Median     3rd Qu.        Max.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept.  1.3575e+01  1.4086e+01  1.5223e+01  1.5700e+01  1.5975e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TotPop90      1.8694e-05  2.0530e-05  2.2791e-05  2.4827e-05  2.5862e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctRural     -5.2549e-02 -4.8286e-02 -4.1900e-02 -3.6000e-02 -3.2038e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctEld       -1.5889e-01 -1.3354e-01 -1.1456e-01 -9.6816e-02 -5.9114e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctFB         8.1590e-01  9.9348e-01  1.3542e+00  1.7432e+00  1.9597e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctPov       -1.8387e-01 -1.6427e-01 -1.2554e-01 -9.4889e-02 -6.5134e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctBlack     -1.2025e-02 -1.7586e-04  1.1587e-02  2.7628e-02  3.8985e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept. 14.7766</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TotPop90      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctRural     -0.0439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctEld       -0.0619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctFB         1.2562</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctPov       -0.1554</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PctBlack      0.0219</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">res.adpt</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">brks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0</span>, <span class="fl">0.01</span>, <span class="fl">0.025</span>, <span class="fl">0.075</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">2</span><span class="op">/</span><span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res.adpt</span><span class="op">$</span><span class="va">SDF</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">res.adpt</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">PctBlack</span>, <span class="va">brks</span>,</span></span>
<span class="r-in"><span> all.inside<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># simulation scenario with patterned dependent variable</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">gSRDF</span><span class="op">)</span><span class="op">*</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">X0</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">X1</span>, center<span class="op">=</span><span class="cn">FALSE</span>, scale.<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span></span>
<span class="r-in"><span><span class="va">gSRDF</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="va">X1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">gSRDF</span><span class="op">$</span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="va">X1</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">gSRDF</span><span class="op">$</span><span class="va">X3</span> <span class="op">&lt;-</span> <span class="va">X1</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, data<span class="op">=</span><span class="va">gSRDF</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, data<span class="op">=</span><span class="va">gSRDF</span>, bandwidth<span class="op">=</span><span class="va">bw</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = PctBach ~ X1 + X2 + X3, data = gSRDF, bandwidth = bw, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     hatmatrix = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 130.6116 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Min.   1st Qu.    Median   3rd Qu.      Max.  Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept.  8.323876  9.743040 10.152873 10.561355 11.388507  9.8045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1           -4.502282 -1.718641 -0.712201 -0.091787  0.958291 -1.3247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -1.875667 -1.242827 -0.856242 -0.362162  0.585513 -1.1137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3           -2.482145 -0.618635  0.218977  0.862259  3.313847  0.2651</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 159 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 14.57996 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 144.42 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 5.658114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 10.63717 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 148.3628 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 5.582425 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 5.392459 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 1012.337 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): 997.6901 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 4623.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.09839479 </span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">gSRDF</span>, <span class="st">"PctBach"</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">gSRDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># pattern in the local coefficients</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># but no "significant" pattern</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1_se"</span>, <span class="st">"X2_se"</span>, <span class="st">"X3_se"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1_se</span></span></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2_se</span></span></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3_se</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1_t"</span>, <span class="st">"X2_t"</span>, <span class="st">"X3_t"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># simulation scenario with random dependent variable</span></span></span>
<span class="r-in"><span><span class="va">yrn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">gSRDF</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gSRDF</span><span class="op">$</span><span class="va">yrn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">yrn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">yrn</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, data<span class="op">=</span><span class="va">gSRDF</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bandwidth converged to upper bound:620.559306125037</span>
<span class="r-in"><span><span class="co"># bandwidth selection maxes out at 620 km, equal to upper bound</span></span></span>
<span class="r-in"><span><span class="co"># of line search</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">yrn</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, data<span class="op">=</span><span class="va">gSRDF</span>, bandwidth<span class="op">=</span><span class="va">bw</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = yrn ~ X1 + X2 + X3, data = gSRDF, bandwidth = bw, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     hatmatrix = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 620.5592 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Min.   1st Qu.    Median   3rd Qu.      Max.  Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept.  0.103959  0.116916  0.127859  0.139786  0.152315  0.1190</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1            0.228180  0.242052  0.253170  0.264197  0.278107  0.2430</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X2           -0.536286 -0.523895 -0.517291 -0.511630 -0.501217 -0.5056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X3            0.095639  0.101254  0.104152  0.108421  0.117669  0.1108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 159 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 4.526364 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 154.4736 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 1.092203 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 4.269576 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 154.7304 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 1.091296 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 1.076544 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 485.6487 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): 478.9464 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 184.2726 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.02455838 </span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">gSRDF</span>, <span class="st">"yrn"</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">gSRDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># pattern in the local coefficients</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># but no "significant" pattern</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1_se"</span>, <span class="st">"X2_se"</span>, <span class="st">"X3_se"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X1_se</span></span></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X2_se</span></span></span>
<span class="r-in"><span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3_t</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3</span><span class="op">/</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">X3_se</span></span></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">SDF</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1_t"</span>, <span class="st">"X2_t"</span>, <span class="st">"X3_t"</span><span class="op">)</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># end of simulations</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">coordinates</span><span class="op">(</span><span class="va">meuse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">meuse</span><span class="op">$</span><span class="va">ffreq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">meuse</span><span class="op">$</span><span class="va">ffreq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">coordinates</span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">meuse.grid</span><span class="op">$</span><span class="va">ffreq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">$</span><span class="va">ffreq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gridded</span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">cadmium</span> <span class="op">~</span> <span class="va">dist</span>, <span class="va">meuse</span>, bandwidth <span class="op">=</span> <span class="fl">228</span>, hatmatrix<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xx</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = cadmium ~ dist, data = meuse, bandwidth = 228, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     hatmatrix = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 228 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at data points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Min.  1st Qu.   Median  3rd Qu.     Max.   Global</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept.   1.2899   3.7496   5.6463   7.2603  12.9459   5.8795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dist         -36.2255 -20.5680 -12.5101  -6.3063  12.1979 -10.9730</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of data points: 155 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (residual: 2traceS - traceS'S): 33.66762 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (residual: 2traceS - traceS'S): 121.3324 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (residual: 2traceS - traceS'S): 2.172593 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective number of parameters (model: traceS): 25.01465 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Effective degrees of freedom (model: traceS): 129.9854 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (model: traceS): 2.099034 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sigma (ML): 1.92221 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 705.4599 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC (GWR p. 96, eq. 4.22): 667.4631 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual sum of squares: 572.7084 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quasi-global R2: 0.7004953 </span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">cadmium</span> <span class="op">~</span> <span class="va">dist</span>, <span class="va">meuse</span>, bandwidth <span class="op">=</span> <span class="fl">228</span>, fit.points <span class="op">=</span> <span class="va">meuse.grid</span>,</span></span>
<span class="r-in"><span> predict<span class="op">=</span><span class="cn">TRUE</span>, se.fit<span class="op">=</span><span class="cn">TRUE</span>, fittedGWRobject<span class="op">=</span><span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gwr(formula = cadmium ~ dist, data = meuse, bandwidth = 228, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fit.points = meuse.grid, se.fit = TRUE, predictions = TRUE, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fittedGWRobject = xx)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel function: gwr.Gauss </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed bandwidth: 228 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit points: 3103</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of GWR coefficient estimates at fit points:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Min.  1st Qu.   Median  3rd Qu.   Max.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X.Intercept.   1.2675   3.1758   4.7424   6.7630 14.151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dist         -39.2780 -16.4603  -8.9569  -4.6925 21.183</span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"pred"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">spplot</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"pred.se"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gwr-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g.bw.gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">PctPov</span> <span class="op">+</span> <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">res.bw</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span> <span class="va">PctPov</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, bandwidth<span class="op">=</span><span class="va">g.bw.gauss</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">res.bw</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">res.bw</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res.bw</span><span class="op">$</span><span class="va">SDF</span>, col<span class="op">=</span><span class="va">cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">res.bw</span><span class="op">$</span><span class="va">SDF</span><span class="op">$</span><span class="va">PctBlack</span>, <span class="va">brks</span>,</span></span>
<span class="r-in"><span>    all.inside<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g.bw.gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="gwr.cv.html">gwr.sel</a></span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">PctPov</span> <span class="op">+</span> <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, longlat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gSRouter</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#  require(maptools)</span></span></span>
<span class="r-in"><span><span class="co">#  SG &lt;- GE_SpatialGrid(gSRouter, maxPixels = 100)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">SG_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">gSRouter</span><span class="op">)</span><span class="op">)</span>, nx<span class="op">=</span><span class="fl">87</span>, ny<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">SG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">SG_0</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">SPxMASK0</span> <span class="op">&lt;-</span> <span class="fu">over</span><span class="op">(</span><span class="va">SG</span>, <span class="va">gSRouter</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">SGDF</span> <span class="op">&lt;-</span> <span class="fu">SpatialGridDataFrame</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slot</a></span><span class="op">(</span><span class="va">SG</span>, <span class="st">"grid"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>SPxMASK0<span class="op">=</span><span class="va">SPxMASK0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      proj4string<span class="op">=</span><span class="fu">CRS</span><span class="op">(</span><span class="fu">proj4string</span><span class="op">(</span><span class="va">gSRouter</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">SPxDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">SGDF</span>, <span class="st">"SpatialPixelsDataFrame"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res.bw</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span> <span class="va">PctPov</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, bandwidth<span class="op">=</span><span class="va">g.bw.gauss</span>, fit.points<span class="op">=</span><span class="va">SPxDF</span>,</span></span>
<span class="r-in"><span>      longlat<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res.bw</span></span></span>
<span class="r-in"><span>    <span class="va">res.bw</span><span class="op">$</span><span class="va">timings</span></span></span>
<span class="r-in"><span>    <span class="fu">spplot</span><span class="op">(</span><span class="va">res.bw</span><span class="op">$</span><span class="va">SDF</span>, <span class="st">"PctBlack"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res.bwc</span> <span class="op">&lt;-</span> <span class="fu">gwr</span><span class="op">(</span><span class="va">PctBach</span> <span class="op">~</span> <span class="va">TotPop90</span> <span class="op">+</span> <span class="va">PctRural</span> <span class="op">+</span> <span class="va">PctEld</span> <span class="op">+</span> <span class="va">PctFB</span> <span class="op">+</span> <span class="va">PctPov</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="va">PctBlack</span>, data<span class="op">=</span><span class="va">gSRDF</span>, bandwidth<span class="op">=</span><span class="va">g.bw.gauss</span>, fit.points<span class="op">=</span><span class="va">SPxDF</span>,</span></span>
<span class="r-in"><span>      longlat<span class="op">=</span><span class="cn">TRUE</span>, cl<span class="op">=</span><span class="va">cl</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res.bwc</span></span></span>
<span class="r-in"><span>    <span class="va">res.bwc</span><span class="op">$</span><span class="va">timings</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Roger Bivand, Danlin Yu.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

